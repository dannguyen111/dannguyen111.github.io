{% assign sorted_projects = site.projects | sort: 'date' | reverse %}

<div class="container position-relative group-container">
    <h2 class="text-center mb-4">My Projects</h2>

    <button id="btn-prev"
        class="btn btn-dark rounded-circle position-absolute start-0 top-50 translate-middle-y z-3 shadow scroll-nav-btn"
        onclick="scrollProjects(-1)" style="width: 45px; height: 45px; margin-left: -20px; display: none;"> ❮
    </button>

    <div id="projects-scroller" class="row flex-nowrap overflow-auto pb-4"
        style="scroll-behavior: smooth; scrollbar-width: none;">

        {% for project in sorted_projects %}
        <div class="col-12 col-md-6 col-lg-4" style="flex: 0 0 auto;">
            <div class="card h-100 shadow-sm">

                {% if project.image %}
                <img src="{{ project.image | relative_url }}" class="card-img-top" alt="{{ project.title }}"
                    style="height: 220px; object-fit: cover;">
                {% endif %}

                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ project.title }}</h5>
                    <p class="card-text">{{ project.description }}</p>
                    <a href="{{ project.url | relative_url }}" class="btn btn-primary mt-auto">View Project</a>
                </div>

            </div>
        </div>
        {% endfor %}

    </div>

    <button id="btn-next"
        class="btn btn-dark rounded-circle position-absolute end-0 top-50 translate-middle-y z-3 shadow scroll-nav-btn"
        onclick="scrollProjects(1)" style="width: 45px; height: 45px; margin-right: -20px;">
        ❯
    </button>

</div>

<script>
    const container = document.getElementById('projects-scroller');
    const btnPrev = document.getElementById('btn-prev');
    const btnNext = document.getElementById('btn-next');

    // Scroll Function
    function scrollProjects(direction) {
        // Scroll by the width of one card (approx 1/3 of container or full width on mobile)
        const scrollAmount = container.clientWidth / (window.innerWidth < 768 ? 1 : 3);
        container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
    }

    // Visibility Logic (Hides arrows at start/end)
    function updateArrowVisibility() {
        const tolerance = 5;

        if (container.scrollLeft <= tolerance) {
            btnPrev.style.display = 'none';
        } else {
            btnPrev.style.display = 'block';
        }

        if (container.scrollLeft + container.clientWidth >= container.scrollWidth - tolerance) {
            btnNext.style.display = 'none';
        } else {
            btnNext.style.display = 'block';
        }
    }

    container.addEventListener('scroll', updateArrowVisibility);
    window.addEventListener('resize', updateArrowVisibility);

    document.addEventListener("DOMContentLoaded", updateArrowVisibility);
</script>

<style>
    #projects-scroller::-webkit-scrollbar {
        display: none;
    }

    #projects-scroller {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .scroll-nav-btn {
        opacity: 0.5;
        transition: opacity 0.3s ease, transform 0.2s ease;
    }

    .scroll-nav-btn:hover {
        opacity: 1 !important;
        transform: translateY(-50%) scale(1.1);
    }
</style>